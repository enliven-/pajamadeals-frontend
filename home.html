<html>
<head>
  <link type="text/css" rel="stylesheet" href="assets/materialize/css/materialize.min.css"  media="screen,projection"/>
  <!-- <meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1.0, user-scalable=yes"> -->
  <!-- <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0"/> -->
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1.0, user-scalable=no"/>

</head>

<body>

<nav id="">
  <div class="container">
    <div class="nav-wrapper">
    <span class="brand-logo">pajamadeals</span>
      <input style="width: 60%;" class="search-input hidden" id="search" autocomplete="off" type="text" placeholder="Search listings ">
      <ul id="nav-mobile" class="right side-nav ?grey ?darken-2">
        <li class="nav-logo">
          <a href>pajamadeals</a>
          <!-- <span>With <i class="mdi-toggle-radio-button-off"></i>!</span> -->
        </li>
        <li>
          <a id="nav-listings" href="#/listings">Listings</a>
        </li>
        <li>
          <a id="nav-orders" href="#/orders">My Orders</a>
        </li>
        <li>
          <a id="nav-new" href="#/new">Post Listing</a>
        </li>
      </ul>
      <a href="#" data-activates="nav-mobile" class="button-collapse"><i class="mdi-navigation-menu"></i></a>
      <ul class="right">
        <a href="" data-activates="" class="right search tool"><i class="mdi-action-search"></i></a>
      </ul>
    </div>
  </div>
</nav>
<div class="tabs-wrapper">
  <div class="row white z-depth-1">
    <div class="container">
      <ul class="tabs">
        <li class="tab"><a id="listings" href="#tab1">Listings</a></li>
        <li class="tab"><a id="orders"   href="#tab2">Orders</a></li>
        <li class="tab"><a id="new"      href="#tab3">New</a></li>
      </ul>
    </div>
  </div>
</div>
















<div class="container">


  <div id="tab1" class="col s12">
    <div class="row">
      <div class="col s12" id="listings-container">

  <div class="preloader-wrapper small active" style="margin-top: 20%; margin-left: 45%;">
    <div class="spinner-layer spinner-blue">
      <div class="circle-clipper left">
        <div class="circle"></div>
      </div><div class="gap-patch">
        <div class="circle"></div>
      </div><div class="circle-clipper right">
        <div class="circle"></div>
      </div>
    </div>

    <div class="spinner-layer spinner-red">
      <div class="circle-clipper left">
        <div class="circle"></div>
      </div><div class="gap-patch">
        <div class="circle"></div>
      </div><div class="circle-clipper right">
        <div class="circle"></div>
      </div>
    </div>

    <div class="spinner-layer spinner-yellow">
      <div class="circle-clipper left">
        <div class="circle"></div>
      </div><div class="gap-patch">
        <div class="circle"></div>
      </div><div class="circle-clipper right">
        <div class="circle"></div>
      </div>
    </div>

    <div class="spinner-layer spinner-green">
      <div class="circle-clipper left">
        <div class="circle"></div>
      </div><div class="gap-patch">
        <div class="circle"></div>
      </div><div class="circle-clipper right">
        <div class="circle"></div>
      </div>
    </div>
  </div>



      </div>
    </div>
  </div>










  <div id="tab2" class="col s12">
    <div class="row">
      <div class="col s12" id="orders-container">

      </div>
    </div>
  </div>




<div id="tab3" class="col s12">
  <div class="row">
    <div class="col s12" id="form-container">

      <div id="input" class="section scrollspy">
        <div class="row">
          <div class="col s2 offset-s9">
            <!-- <h5>New Listing</h5> -->
            <!-- <p>Text fields allow user input. The border should light up simply and clearly indicating which field the user is currently editing.</p> -->
            <a href="#/" class="form-close"><i class="mdi-navigation-close red-text hide hidden"></i></a>
          </div>
        </div>
        <div class="row">
          <form class="col s12 listing">
            <div class="row">
              <div class="input-field col s12">
                <input name="title" id="title" type="text" class="disable" autocomplete="off" required>
                <label for="title">Title</label>
              </div>
            </div>
            <div class="hide hidden">
            <div class="row">
              <div class="input-field col s12">
                <input name="authors" id="authors" class="disable" disabled="" type="text" required>
                <label for="authors">Authors</label>
              </div>
            </div>
            <div class="row">
              <div class="input-field col s12">
                <input name="publication" id="publication"  class="disable" disabled=""  type="text" required>
                <label for="publication">Publicaiton</label>
              </div>
            </div>
            <div class="row">
              <p class="grey-text">Condition</p>  
              <div class="input-field col s4">
                <input name="quality" value="like new" type="radio" id="test1"/>
                <label for="test1">Like New</label>
              </div>
              <div class="input-field col s3">
                <input name="quality" value="fair" type="radio" id="test2"/>
                <label for="test2">Fair</label>
              </div>
              <div class="input-field col s4">
                <input name="quality" value="heavily used" type="radio" id="test3"/>
                <label for="test3">Heavily Used</label>    
              </div>
            </div>
            <br>
            <div class="row">
              <p class="grey-text">Markings</p>  
              <div class="input-field col s4">
                <input name="markings" value="no markings" type="radio" id="test4"/>
                <label for="test4">None</label>
              </div>
              <div class="input-field col s3">
                <input name="markings" value="few markings" type="radio" id="test5"/>
                <label for="test5">Few</label>
              </div>
              <div class="input-field col s4">
                <input name="markings" value="heavily marked" type="radio" id="test6"/>
                <label for="test6">Heavy</label>  
              </div>
            </div>
            <br>
            <div class="row">
              <div class="input-field col s12">
                <input name="mrp" id="mrp" type="text" required>
                <label for="mrp">MRP</label>
              </div>
            </div>
            <div class="row">
              <div class="input-field col s6">
                <input name="price" id="price" type="text" required>
                <label for="price">Price</label>
              </div>
              <div class="input-field col s6">
                <input name="sug-price" id="sug-price"  class="disable" disabled="" type="text" required>
                <label for="sug-price">Suggested Price</label>
              </div>
            </div>
            <div class="row">
              <div class="input-field col s12">
                <textarea name="description" id="description"></textarea>                
                <label for="description">Description</label>
              </div>
            </div>
            <div class="row">
              <div class="input-field col s6">
                <button class="btn waves-effect waves-light red lighten-2" name="cancel">Cancel
                  <i class="mdi-navigation-close right"></i>
                </button>
              </div>
              <div class="input-field col s6">
                <a class="btn waves-effect waves-light create" name="action">Submit
                  <i class="mdi-navigation-check right"></i>
                </a>
              </div>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>

</div>




<script type="text/template" id="pre-loader">
  <div class="preloader-wrapper small active" style="margin-top: 20%; margin-left: 45%;">
    <div class="spinner-layer spinner-blue">
      <div class="circle-clipper left">
        <div class="circle"></div>
      </div><div class="gap-patch">
        <div class="circle"></div>
      </div><div class="circle-clipper right">
        <div class="circle"></div>
      </div>
    </div>

    <div class="spinner-layer spinner-red">
      <div class="circle-clipper left">
        <div class="circle"></div>
      </div><div class="gap-patch">
        <div class="circle"></div>
      </div><div class="circle-clipper right">
        <div class="circle"></div>
      </div>
    </div>

    <div class="spinner-layer spinner-yellow">
      <div class="circle-clipper left">
        <div class="circle"></div>
      </div><div class="gap-patch">
        <div class="circle"></div>
      </div><div class="circle-clipper right">
        <div class="circle"></div>
      </div>
    </div>

    <div class="spinner-layer spinner-green">
      <div class="circle-clipper left">
        <div class="circle"></div>
      </div><div class="gap-patch">
        <div class="circle"></div>
      </div><div class="circle-clipper right">
        <div class="circle"></div>
      </div>
    </div>
  </div>
</script>


<script type="text/template" id="order-template">
<div class="card">
  <div class="row">
    <div style="padding: 20px 0 10px 20px;" class="card-image col s3">
      <img style="height: 70px; width: 60px;" src="assets/images/book1.jpg">
    </div>
    <div style="padding-left: 0px; padding-bottom: 0px;" class="card-content col s9">
      <span style="font-size: 16px; font-weight: 500; color: gray;"class="title">{{ title }}</span> <br>
      <span class="vol">{{ vol }}</span>
      <span style="font-weight: 300;" class="authors">{{ authors }}</span> <br>
      <span style="font-weight: 200; font-size: 13px; font-style: italic;" class="publication">{{ publication }}</span> <br>
      <span class="condition">{{ condition }}</span>
      <span class="markings">{{ markings }}</span> <br>
      <span class="status">{{ status }}</span> <br>

    </div>
  </div>
  <div class="row">
    <div style="padding-left: 20px;" class="col s8">
      Rs <span style="text-decoration: line-through;" class="mrp"> {{ mrp }}</span><br>
      <span style="color: red;" class="price">  Rs {{ price }}</span>
    </div>
    <div class="col s3">
      <a class="waves-effect waves-light btn white-text cancel {{status}}">Cancel</a>
    </div>
  </div>
</div>  
</script>




<script type="text/javascript" src="assets/js/jquery.min.js"></script>
<script type="text/javascript" src="assets/js/jquery-ui.min.js"></script>
<script type="text/javascript" src="assets/js/underscore.min.js"></script>
<script type="text/javascript" src="assets/js/mustache.min.js"></script>
<script type="text/javascript" src="assets/js/backbone.min.js"></script>
<script type="text/javascript" src="assets/js/helpers.js"></script>
<script type="text/javascript" src="assets/materialize/js/materialize.min.js"></script>

<script type="text/javascript" src="app/app.js"></script>

<script type="text/javascript" src="app/models/book.js"></script>
<script type="text/javascript" src="app/models/listing.js"></script>
<script type="text/javascript" src="app/models/order.js"></script>
<script type="text/javascript" src="app/collections/books.js"></script>
<script type="text/javascript" src="app/collections/listings.js"></script>
<script type="text/javascript" src="app/collections/orders.js"></script>
<script type="text/javascript" src="app/views/book.js"></script>
<script type="text/javascript" src="app/views/books.js"></script>
<script type="text/javascript" src="app/views/listing.js"></script>
<script type="text/javascript" src="app/views/order.js"></script>
<script type="text/javascript" src="app/views/listings.js"></script>
<script type="text/javascript" src="app/views/orders.js"></script>
<script type="text/javascript" src="app/routes.js"></script>


<style>
.hidden {
  display: none;
}
.card-image {
  padding: 10px 5px 10px 5px;
}
input, textarea {
  max-width:100%
}
.ui-helper-hidden-accessible {
  display: none;
}
.ui-autocomplete.ui-menu {
  width: 300px;
}
.order {
  border-bottom: 1px solid gray;
}
.input-field input[type=text]:valid {
  border-bottom: none;
  box-shadow: 1px solid #bdbdbd;
  -webkit-box-shadow: 1px solid #bdbdbd;
}
.input-field textarea:valid {
  border-bottom: none;
  box-shadow: 1px solid #bdbdbd;
  -webkit-box-shadow: 1px solid #bdbdbd;
}

.tabs-wrapper + .container {
  margin: auto;
  width: 95%;
  padding: 0px;
}

.card {
  box-shadow: none;
  margin-top: 0px;
  -webkit-box-shadow: none;
  border-bottom: 1px solid lightgray;
}
.card > .row {
  margin-bottom: 0px;
}
.mdi-action-search, .mdi-navigation-close, nav a.button-collapse i {
  font-size: 2.0rem;
}
input#search {
  margin-bottom: 0px;
  margin-left: 15px;
  height: 3.5rem;
  line-height: 1em;
}
input#search:focus {
  border-bottom: none;
  box-shadow: 1px solid #bdbdbd !important;
  -webkit-box-shadow: 1px solid #bdbdbd !important;
  height: 3.5rem;
}
#listings-container {
  /*margin-top: -20px;*/
}
nav .brand-logo {
  width: auto;
  margin-left: 22%; 
}

ul#nav-mobile.side-nav {
  background-color: #3c3933;
}

.nav-logo {
 background-color: #ee6e73;
}
.nav-logo > a {
 font-size: 1.5rem !important;
}

ul#nav-mobile.side-nav > li:not(:first-child) {
  line-height: 45px;
}
ul#nav-mobile.side-nav > li {
  border-bottom: 1px solid #57544e;
}
ul#nav-mobile.side-nav > li > a {
  color: white;
  font-size: 1.2rem;
}

#form-container > .scrollspy > .row:first-child {
  margin-bottom: 0px;
}

#toast-container {
  margin-bottom: 20px;
}
#toast-container > .toast {
  width: 95% !important;
  margin: auto;
}

</style>
<script>
$(document).ready(function() {
  $('.button-collapse').sideNav({menuWidth: 240, activationWidth: 70});
  $('ul.tabs').tabs();


  $('#listings').on('click', function(e) {
    console.log('listings!')
    app.router.trigger('route:home')
  });

  $('#orders').on('click', function(e) {
    app.router.trigger('route:orders')
  });

  $('#orders').on('click', function(e) {
  });

  $('#nav-listings').on('click', function(e){
    e.preventDefault();
    $('#listings').click();
    $('#nav-mobile').animate( { "left": "-=240px" }, "slow");
    $('#sidenav-overlay').remove();
  });

  $('#nav-orders').on('click', function(e){
    e.preventDefault();
    $('#orders').click();
    $('#nav-mobile').animate( { "left": "-=240px" }, "slow");
    $('#sidenav-overlay').remove();
  });

  $('#nav-new').on('click', function(e){
    e.preventDefault();
    $('#new').click();
    $('#nav-mobile').animate( { "left": "-=240px" }, "slow");
    $('#sidenav-overlay').remove();
  });


  $('body').on('click', 'ul.tabs a', function(e) {
    blur_search();
  });

  $('body').on('click', 'ul.side-nav a', function(e) {
    blur_search();
  });



  $.widget( "ui.autocomplete", $.ui.autocomplete, {
    _renderMenu : function( ul, items ) {
      console.log(items);
                    var that = this;
                    $.each( items, function( index, item ) {
                      that._renderItemData( ul, item );
                    });
                    $( ul ).addClass("collection");
                  },
    _renderItem : function( ul, item ) {
                    return $( "<li>" )
                      .addClass("collection-item")
                      .append( item.title )
                      .append( "<br>")
                      .append( item.authors )
                      .append( "<br>")
                      .append( item.publication )
                      .appendTo( ul );
                  }
  });



  $("#search").autocomplete({
    source      : function(req, resp_fn) {
                    var term = req.term.toLowerCase();
                    console.log(term)
                    $.ajax({
                      // url       : 'http://backend.pajamadeals.in/listings',
                      url       : $.host + '/listings',
                      dataType  : 'json',
                      success   : function(response) {
                                    var results = _.filter(response, function(item) { return item.title.toLowerCase().indexOf(term) != -1; } );
                                    // resp_fn(results);
                                    // console.log(results)
                                    var filteredView = new app.ListingsView(results);
                                    $('#listings-container').html('');
                                    filteredView.renderListings();
                                  },
                      error     : function(response) { console.log('error in autocomplete'); }
                    });
                  },
    minLength   : 4,
    messages    : {
                    noResults   : '',
                    results     : function() {}
                  },
    search      : function(event, ui) {
                    renderPreloader($('#listings-container'));
                  },
    select      : function( event, ui ) {
                    // populateAndShowForm(ui.item);
                    // $('#title').val(book.title);
                    console.log('lll')
                  }
  });


  $("#title").autocomplete({
    source      : function(req, resp_fn) {
                    var term = req.term.toLowerCase();
                    console.log(term)
                    $.ajax({
                      // url       : '/api/books.json',
                      // url       : 'http://localhost:9393/books',
                      // url       : 'http://backend.pajamadeals.in/books',
                      url       : $.host + '/books',
                      dataType  : 'json',
                      success   : function(response) {
                                    var results = _.filter(response, function(item) { return item.title.toLowerCase().indexOf(term) != -1; } );
                                    resp_fn(results)
                                  },
                      error     : function(response) { console.log('error in autocomplete'); }
                    });
                  },
    minLength   : 4,
    messages    : {
                    noResults   : '',
                    results     : function() {}
                  },
    select      : function( event, ui ) {
                    populateAndShowForm(ui.item);
                    $('#title').attr('disabled', '').val(book.title);
                  }
  });



  var populateAndShowForm = function(book) {
    $('#title').val(book.title);
    $('#authors').val(book.authors);
    $('#publication').val(book.publication);
    $('#sug-price').val(300);


    $('form input[type=text] + label').addClass('active');
    $('#form-container .hide.hidden').removeClass('hidden');
  };

  var focus_search = function() {
    $('#listings').click();
    $('.brand-logo').html('');
    $('.search-input').removeClass('hidden').focus();
    $('.search').removeClass('search').addClass('search-close').find('i').removeClass().addClass('mdi-navigation-close');
  };

  var blur_search  = function() {
    $('.brand-logo').addClass('hidden');
    $('.search-input').blur().addClass('hidden').val('');
    $('nav .brand-logo').html('pajamadeals');
    $('.search-close').removeClass('search-close').addClass('search').find('i').removeClass().addClass('mdi-action-search');
  };


  $('.nav-wrapper').on('click', '.search', function(e) {
    e.preventDefault();
    focus_search();
  });

  $('.nav-wrapper').on('click', '.search-close', function(e) {
    e.preventDefault();
    blur_search();
    app.router.trigger('route:home');
  });

 
  var clearForm = function() {
    $('form input[type="text"]').each(function() {
        $(this).val("");  
    });
    $('form input[type="radio"]').each(function() {
        $(this).prop('checked', false);
    });
  }

  $('body').on('click', '.form-close', function(e) {
    clearForm();
    $('#form-container .hide').addClass('hidden');
    $('#title').removeAttr('disabled').focus();
  });



});
</script>


</body>
</html>